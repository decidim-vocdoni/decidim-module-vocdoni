<% add_decidim_page_title(translated_attribute(election.title)) %>
<% add_decidim_page_title(t(".title")) %>

<div class="card js-vocdoni-client"
  data-default-locale="<%= current_organization.default_locale %>"
  data-vocdoni-wallet-private-key="<%= @current_vocdoni_wallet.private_key %>"
  <% if @election.vocdoni_election_id %>
    data-vocdoni-election-id="<%= @election.vocdoni_election_id %>"
  <% end %>
  data-vocdoni-env="<%= Decidim::Vocdoni.config.api_endpoint_env %>">

  <div class="card-divider">
    <h2 class="card-title">
      <%= link_to translated_attribute(election.title), elections_path %> &gt;
      <%= t("index.title", scope: "decidim.vocdoni.admin.steps") %>
    </h2>
  </div>

  <div class="card-section">
    <% steps(current_step).each_with_index do |step, i| %>
      <% if i > 0 %>&nbsp;&gt;&nbsp;<% end %>
      <span class="<%= step.last %>"><%= t("steps.#{step.first}.title", scope: "decidim.vocdoni.admin") %></span>
    <% end %>
  </div>

  <%= render partial: "available_credits" %>
</div>

<% if @form %>
  <%= decidim_form_for(@form, url: election_step_path(election, current_step), method: :patch, html: { class: "form step #{current_step}" }) do |f| %>
    <%= render partial: current_step.to_s, locals: { form: @form, f: f } %>

    <%= f.hidden_field :current_step %>

    <% if @form.main_button? %>
      <div class="button--double form-general-submit">
        <%= f.button type: :submit, class: "button", disabled: @form.invalid? do %>
          <span class="hide loading">
            <span class="loading-spinner"></span>
            <%= t("steps.processing", scope: "decidim.vocdoni.admin") %>
          </span>
          <span class="text">
            <%= t("steps.#{current_step}.submit", scope: "decidim.vocdoni.admin") %>
          </span>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% else %>
  <div class="content <%= current_step %>">
    <%= render partial: current_step.to_s %>
  </div>
<% end %>

<%= javascript_pack_tag "decidim_vocdoni_admin" %>

<%= render partial: "vocdoni_logo" %>
