<div class="card">
  <div class="card-divider">
    <h2 class="card-title">
      <%= t("index.title", scope: "decidim.vocdoni.admin.census") %>
    </h2>
  </div>
  <div class="card-section">
    <% if @status.ready_to_setup? %>
      <div class="callout success">
        <p><%= t("status.ready_to_setup", scope: "decidim.vocdoni.admin.census", steps_path: election_steps_path(election)) %></p>
      </div>
    <% end %>
    <p>
    <%= t("index.info_html", scope: "decidim.vocdoni.admin.census") %>
    </p>
  </div>
</div>

<div class="card">
  <div class="card-divider">
    <h2 class="card-title">
      <%= t("status.title", scope: "decidim.vocdoni.admin.census") %>
    </h2>
  </div>
  <div class="card-section">
    <% if @status.count > 0 %>
      <p><%= t("decidim.vocdoni.admin.census.status.data", count: @status.count,
               due_date: l(@status.last_import_at, format: :long)) %>
      </p>
      <%= link_to t("decidim.vocdoni.admin.census.destroy.title"),
        destroy_all_election_census_path(election),
        method: :delete,
        class: "button alert",
        data: { confirm: t("decidim.vocdoni.admin.census.destroy.confirm") } %>
    <% else %>
      <p><%= t("status.empty", scope: "decidim.vocdoni.admin.census") %></p>
    <% end %>
  </div>
</div>

<% if @status.pending_upload? %>
  <div class="card">
    <div class="card-divider">
      <h2 class="card-title">
        <%= t("new.title", scope: "decidim.vocdoni.admin.census") %>
      </h2>
    </div>
    <div class="card-section">
      <p><%= t("decidim.vocdoni.admin.census.new.info") %></p>
      <pre class="code-block">
  email;born_at
  user@example.org;1984-01-25
  user2@example.org;2000-12-15</pre>
      <%= decidim_form_for @form, url: election_census_path(election), multipart: true do |form| %>
        <%= label_tag :file, t("new.file", scope: "decidim.vocdoni.admin.census") %>
        <%= form.file_field :file, required: true %>
        <%= submit_tag t("new.submit", scope: "decidim.vocdoni.admin.census"), class: "button" %>
      <% end %>
    </div>
  </div>
<% end %>

<% if @status.pending_generation? %>
  <div class="card">
    <div class="card-divider">
      <h2 class="card-title">
        <%= t("generate.title", scope: "decidim.vocdoni.admin.census") %>
      </h2>
    </div>
    <div class="card-section">
      <p><%= t("decidim.vocdoni.admin.census.generate.info") %></p>
      <%= decidim_form_for @form, url: election_census_path(election) do |f| %>
        <% f.object.credentials.each do |credential| %>
          <%= content_tag "ul", class: "credentials hide" do %>
            <%= f.fields_for "credentials[]", credential do |credential_form| %>
              <%= content_tag "li", data: { credential: credential.id } do %>
                <%= credential_form.text_field :email, class: "credential_email" %>
                <%= credential_form.text_field :born_at, class: "credential_born_at" %>
                <%= credential_form.text_field :wallet_public_key, class: "credential_wallet_public_key" %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        <div class="button--double">
          <%= f.submit t("generate.submit", scope: "decidim.vocdoni.admin.census") %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<%= javascript_pack_tag "decidim_vocdoni_admin" %>
